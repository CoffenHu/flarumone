System.register("flags/addFlagControl",["flarum/extend","flarum/app","flarum/utils/PostControls","flarum/components/Button","flags/components/FlagPostModal"],function(t){"use strict";var e,n,o,a,r;return{setters:[function(t){e=t.extend},function(t){n=t["default"]},function(t){o=t["default"]},function(t){a=t["default"]},function(t){r=t["default"]}],execute:function(){t("default",function(){e(o,"userControls",function(t,e){!e.isHidden()&&"comment"===e.contentType()&&e.canFlag()&&e.user()!==n.session.user&&t.add("flag",m(a,{icon:"flag",onclick:function(){return n.modal.show(new r({post:e}))}},"Flag"))})})}}}),System.register("flags/addFlagsDropdown",["flarum/extend","flarum/app","flarum/components/HeaderSecondary","flags/components/FlagsDropdown"],function(t){"use strict";var e,n,o,a;return{setters:[function(t){e=t.extend},function(t){n=t["default"]},function(t){o=t["default"]},function(t){a=t["default"]}],execute:function(){t("default",function(){e(o.prototype,"items",function(t){n.forum.attribute("canViewFlags")&&t.add("flags",m(a,null),15)})})}}}),System.register("flags/addFlagsToPosts",["flarum/extend","flarum/app","flarum/components/CommentPost","flarum/components/Button","flarum/helpers/punctuate","flarum/helpers/username","flarum/utils/ItemList","flarum/utils/PostControls"],function(t){"use strict";var e,n,o,a,r,i,s,u;return{setters:[function(t){e=t.extend},function(t){n=t["default"]},function(t){o=t["default"]},function(t){a=t["default"]},function(t){r=t["default"]},function(t){i=t["default"]},function(t){s=t["default"]},function(t){u=t["default"]}],execute:function(){t("default",function(){e(o.prototype,"attrs",function(t){this.props.post.flags().length&&(t.className+=" Post--flagged")}),o.prototype.dismissFlag=function(t){var e=this.props.post;return delete e.data.relationships.flags,this.subtree.invalidate(),n.cache.flags&&n.cache.flags.some(function(t,o){if(t.post()===e){if(n.cache.flags.splice(o,1),n.cache.flagIndex===e){var a=n.cache.flags[o];if(a||(a=n.cache.flags[0]),a){var r=a.post();n.cache.flagIndex=r,m.route(n.route.post(r))}}return!0}}),n.request({url:n.forum.attribute("apiUrl")+e.apiEndpoint()+"/flags",method:"DELETE",data:t})},o.prototype.flagActionItems=function(){var t=this,n=new s,o=u.destructiveControls(this.props.post);return Object.keys(o).forEach(function(n){var a=o[n].content.props;a.className="Button",e(a,"onclick",function(){return t.dismissFlag()})}),n.merge(o),n.add("dismiss",m(a,{className:"Button Button--icon Button--link",icon:"times",onclick:this.dismissFlag.bind(this),title:"Dismiss Flag"}),-100),n},e(o.prototype,"content",function(t){var e=this,n=this.props.post,o=n.flags();o.length&&(n.isHidden()&&(this.revealContent=!0),t.unshift(m("div",{className:"Post-flagged"},m("div",{className:"Post-flagged-flags"},o.map(function(t){return m("div",{className:"Post-flagged-flag"},e.flagReason(t))})),m("div",{className:"Post-flagged-actions"},this.flagActionItems().toArray()))))}),o.prototype.flagReason=function(t){if("user"===t.type()){var e=t.user(),o=t.reason(),a=t.reasonDetail();return[n.trans(o?"flags.flagged_by_with_reason":"flags.flagged_by",{user:e,reason:o}),a?m("span",{className:"Post-flagged-detail"},a):""]}}})}}}),System.register("flags/main",["flarum/app","flarum/Model","flags/models/Flag","flags/components/FlagsPage","flags/addFlagControl","flags/addFlagsDropdown","flags/addFlagsToPosts"],function(t){"use strict";var e,n,o,a,r,i,s;return{setters:[function(t){e=t["default"]},function(t){n=t["default"]},function(t){o=t["default"]},function(t){a=t["default"]},function(t){r=t["default"]},function(t){i=t["default"]},function(t){s=t["default"]}],execute:function(){e.initializers.add("flags",function(){e.store.models.posts.prototype.flags=n.hasMany("flags"),e.store.models.posts.prototype.canFlag=n.attribute("canFlag"),e.store.models.flags=o,e.routes.flags={path:"/flags",component:m(a,null)},r(),i(),s()})}}}),System.register("flags/models/Flag",["flarum/Model","flarum/utils/mixin"],function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o,a,r,i=function(t,e,n){for(var o=!0;o;){var a=t,r=e,i=n;s=l=u=void 0,o=!1,null===a&&(a=Function.prototype);var s=Object.getOwnPropertyDescriptor(a,r);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(i)}var l=Object.getPrototypeOf(a);if(null===l)return void 0;t=l,e=r,n=i,o=!0}};return{setters:[function(t){o=t["default"]},function(t){a=t["default"]}],execute:function(){r=function(t){function o(){e(this,o),i(Object.getPrototypeOf(o.prototype),"constructor",this).apply(this,arguments)}return n(o,t),o}(a(o,{type:o.attribute("type"),reason:o.attribute("reason"),reasonDetail:o.attribute("reasonDetail"),time:o.attribute("time",o.transformDate),post:o.hasOne("post"),user:o.hasOne("user")})),t("default",r)}}}),System.register("flags/components/FlagList",["flarum/Component","flarum/components/LoadingIndicator","flarum/helpers/avatar","flarum/helpers/username","flarum/helpers/icon","flarum/helpers/humanTime"],function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o,a,r,i,s,u,l,c=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),f=function(t,e,n){for(var o=!0;o;){var a=t,r=e,i=n;s=l=u=void 0,o=!1,null===a&&(a=Function.prototype);var s=Object.getOwnPropertyDescriptor(a,r);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(i)}var l=Object.getPrototypeOf(a);if(null===l)return void 0;t=l,e=r,n=i,o=!0}};return{setters:[function(t){o=t["default"]},function(t){a=t["default"]},function(t){r=t["default"]},function(t){i=t["default"]},function(t){s=t["default"]},function(t){u=t["default"]}],execute:function(){l=function(t){function o(){e(this,o);for(var t=arguments.length,n=Array(t),a=0;t>a;a++)n[a]=arguments[a];f(Object.getPrototypeOf(o.prototype),"constructor",this).apply(this,n),this.loading=!1}return n(o,t),c(o,[{key:"view",value:function(){var t=app.cache.flags||[];return m("div",{className:"NotificationList FlagList"},m("div",{className:"NotificationList-header"},m("h4",{className:"App-titleControl App-titleControl--text"},"Flagged Posts")),m("div",{className:"NotificationList-content"},m("ul",{className:"NotificationGroup-content"},t.length?t.map(function(t){var e=t.post();return m("li",null,m("a",{href:app.route.post(e),className:"Notification Flag",config:function(t,n){m.route.apply(this,arguments),n||$(t).on("click",function(){return app.cache.flagIndex=e})}},r(e.user()),s("flag",{className:"Notification-icon"}),m("span",{className:"Notification-content"},i(e.user())," in ",m("em",null,e.discussion().title())),u(t.time()),m("div",{className:"Notification-excerpt"},e.contentPlain())))}):this.loading?a.component({className:"LoadingIndicator--block"}):m("div",{className:"NotificationList-empty"},app.trans("flags.no_flags")))))}},{key:"load",value:function(){var t=this;(!app.cache.flags||app.forum.attribute("unreadFlagsCount"))&&(this.loading=!0,m.redraw(),app.store.find("flags").then(function(e){app.forum.pushAttributes({unreadFlagsCount:0}),app.cache.flags=e.sort(function(t,e){return e.time()-t.time()}),t.loading=!1,m.redraw()}))}}]),o}(o),t("default",l)}}}),System.register("flags/components/FlagPostModal",["flarum/components/Modal","flarum/components/Button"],function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o,a,r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),s=function(t,e,n){for(var o=!0;o;){var a=t,r=e,i=n;s=l=u=void 0,o=!1,null===a&&(a=Function.prototype);var s=Object.getOwnPropertyDescriptor(a,r);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(i)}var l=Object.getPrototypeOf(a);if(null===l)return void 0;t=l,e=r,n=i,o=!0}};return{setters:[function(t){o=t["default"]},function(t){a=t["default"]}],execute:function(){r=function(t){function o(){e(this,o);for(var t=arguments.length,n=Array(t),a=0;t>a;a++)n[a]=arguments[a];s(Object.getPrototypeOf(o.prototype),"constructor",this).apply(this,n),this.reason=m.prop(""),this.reasonDetail=m.prop("")}return n(o,t),i(o,[{key:"className",value:function(){return"FlagPostModal Modal--small"}},{key:"title",value:function(){return"Flag Post"}},{key:"content",value:function(){return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"Choose a Reason"),m("div",null,m("label",{className:"checkbox"},m("input",{type:"radio",name:"reason",checked:"off_topic"===this.reason(),value:"off_topic",onclick:m.withAttr("value",this.reason)}),"Off-topic"),m("label",{className:"checkbox"},m("input",{type:"radio",name:"reason",checked:"inappropriate"===this.reason(),value:"inappropriate",onclick:m.withAttr("value",this.reason)}),"Inappropriate"),m("label",{className:"checkbox"},m("input",{type:"radio",name:"reason",checked:"spam"===this.reason(),value:"spam",onclick:m.withAttr("value",this.reason)}),"Spam"),m("label",{className:"checkbox"},m("input",{type:"radio",name:"reason",checked:"other"===this.reason(),value:"other",onclick:m.withAttr("value",this.reason)}),"Other","other"===this.reason()?m("textarea",{className:"FormControl",value:this.reasonDetail(),oninput:m.withAttr("value",this.reasonDetail)}):""))),m("div",{className:"Form-group"},m(a,{className:"Button Button--primary",type:"submit",loading:this.loading,disabled:!this.reason()},"Flag Post"))))}},{key:"onsubmit",value:function(t){var e=this;t.preventDefault(),this.loading=!0,app.store.createRecord("flags").save({reason:"other"===this.reason()?null:this.reason(),reasonDetail:this.reasonDetail(),relationships:{user:app.session.user,post:this.props.post}}).then(function(){return e.hide()},function(){e.loading=!1,m.redraw()})}}]),o}(o),t("default",r)}}}),System.register("flags/components/FlagsDropdown",["flarum/components/NotificationsDropdown","flags/components/FlagList"],function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o,a,r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),s=function(t,e,n){for(var o=!0;o;){var a=t,r=e,i=n;s=l=u=void 0,o=!1,null===a&&(a=Function.prototype);var s=Object.getOwnPropertyDescriptor(a,r);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(i)}var l=Object.getPrototypeOf(a);if(null===l)return void 0;t=l,e=r,n=i,o=!0}};return{setters:[function(t){o=t["default"]},function(t){a=t["default"]}],execute:function(){r=function(t){function o(){e(this,o);for(var t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];s(Object.getPrototypeOf(o.prototype),"constructor",this).apply(this,n),this.list=new a}return n(o,t),i(o,null,[{key:"initProps",value:function(t){t.label=t.label||"Flagged Posts",t.icon=t.icon||"flag",s(Object.getPrototypeOf(o),"initProps",this).call(this,t)}}]),i(o,[{key:"goToRoute",value:function(){m.route(app.route("flags"))}},{key:"getUnreadCount",value:function(){return app.forum.attribute("unreadFlagsCount")}}]),o}(o),t("default",r)}}}),System.register("flags/components/FlagsPage",["flarum/components/Page","flags/components/FlagList"],function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o,a,r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),s=function(t,e,n){for(var o=!0;o;){var a=t,r=e,i=n;s=l=u=void 0,o=!1,null===a&&(a=Function.prototype);var s=Object.getOwnPropertyDescriptor(a,r);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(i)}var l=Object.getPrototypeOf(a);if(null===l)return void 0;t=l,e=r,n=i,o=!0}};return{setters:[function(t){o=t["default"]},function(t){a=t["default"]}],execute:function(){r=function(t){function o(){e(this,o);for(var t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];s(Object.getPrototypeOf(o.prototype),"constructor",this).apply(this,n),app.history.push("flags"),this.list=new a,this.list.load(),this.bodyClass="App--flags"}return n(o,t),i(o,[{key:"view",value:function(){return m("div",{className:"FlagsPage"},this.list.render())}}]),o}(o),t("default",r)}}});