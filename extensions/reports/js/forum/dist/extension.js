System.register("reports/addReportControl",["flarum/extend","flarum/app","flarum/utils/PostControls","flarum/components/Button","reports/components/ReportPostModal"],function(t){"use strict";var e,o,r,n,a;return{setters:[function(t){e=t.extend},function(t){o=t["default"]},function(t){r=t["default"]},function(t){n=t["default"]},function(t){a=t["default"]}],execute:function(){t("default",function(){e(r,"userControls",function(t,e){!e.isHidden()&&"comment"===e.contentType()&&e.canReport()&&e.user()!==o.session.user&&t.add("report",m(n,{icon:"flag",onclick:function(){return o.modal.show(new a({post:e}))}},"Report"))})})}}}),System.register("reports/addReportsDropdown",["flarum/extend","flarum/app","flarum/components/HeaderSecondary","reports/components/ReportsDropdown"],function(t){"use strict";var e,o,r,n;return{setters:[function(t){e=t.extend},function(t){o=t["default"]},function(t){r=t["default"]},function(t){n=t["default"]}],execute:function(){t("default",function(){e(r.prototype,"items",function(t){o.forum.attribute("canViewReports")&&t.add("reports",m(n,null),15)})})}}}),System.register("reports/addReportsToPosts",["flarum/extend","flarum/app","flarum/components/CommentPost","flarum/components/Button","flarum/helpers/punctuate","flarum/helpers/username","flarum/utils/ItemList","flarum/utils/PostControls"],function(t){"use strict";var e,o,r,n,a,i,s,u;return{setters:[function(t){e=t.extend},function(t){o=t["default"]},function(t){r=t["default"]},function(t){n=t["default"]},function(t){a=t["default"]},function(t){i=t["default"]},function(t){s=t["default"]},function(t){u=t["default"]}],execute:function(){t("default",function(){e(r.prototype,"attrs",function(t){this.props.post.reports().length&&(t.className+=" Post--reported")}),r.prototype.dismissReport=function(t){var e=this.props.post;return delete e.data.relationships.reports,this.subtree.invalidate(),o.cache.reports&&o.cache.reports.some(function(t,r){if(t.post()===e){if(o.cache.reports.splice(r,1),o.cache.reportIndex===e){var n=o.cache.reports[r];if(n||(n=o.cache.reports[0]),n){var a=n.post();o.cache.reportIndex=a,m.route(o.route.post(a))}}return!0}}),o.request({url:o.forum.attribute("apiUrl")+e.apiEndpoint()+"/reports",method:"DELETE",data:t})},r.prototype.reportActionItems=function(){var t=this,e=new s;return this.props.post.isHidden()?this.props.post.canDelete()&&e.add("delete",m(n,{className:"Button",icon:"trash-o",onclick:function(){t.dismissReport().then(function(){u.deleteAction.apply(t.props.post),m.redraw()})}},"Delete Forever"),100):e.add("hide",m(n,{className:"Button",icon:"trash-o",onclick:function(){t.dismissReport().then(function(){u.hideAction.apply(t.props.post),m.redraw()})}},"Delete Post"),100),e.add("dismiss",m(n,{className:"Button Button--icon Button--link",icon:"times",onclick:this.dismissReport.bind(this)},"Dismiss Report"),-100),e},e(r.prototype,"content",function(t){var e=this.props.post,r=e.reports();if(r.length){e.isHidden()&&(this.revealContent=!0);var n=r.map(function(t){var e=t.user();return e?m("a",{href:o.route.user(e),config:m.route},i(e)):t.reporter()}),s=[],u=r.map(function(t){return t.reason()}).filter(function(t){return t&&-1===s.indexOf(t)?(s.push(t),!0):void 0}),c=r.map(function(t){return t.reasonDetail()}).filter(function(t){return t});t.unshift(m("div",{className:"Post-reported"},m("div",{className:"Post-reported-summary"},o.trans(u.length?"reports.reported_by_with_reason":"reports.reported_by",{reasons:a(u.map(function(t){return o.trans("reports.reason_"+t,void 0,t)})),users:a(n)}),c.map(function(t){return m("div",{className:"Post-reported-detail"},t)})),m("div",{className:"Post-reported-actions"},this.reportActionItems().toArray())))}})})}}}),System.register("reports/main",["flarum/app","flarum/Model","reports/models/Report","reports/components/ReportsPage","reports/addReportControl","reports/addReportsDropdown","reports/addReportsToPosts"],function(t){"use strict";var e,o,r,n,a,i,s;return{setters:[function(t){e=t["default"]},function(t){o=t["default"]},function(t){r=t["default"]},function(t){n=t["default"]},function(t){a=t["default"]},function(t){i=t["default"]},function(t){s=t["default"]}],execute:function(){e.initializers.add("reports",function(){e.store.models.posts.prototype.reports=o.hasMany("reports"),e.store.models.posts.prototype.canReport=o.attribute("canReport"),e.store.models.reports=r,e.routes.reports={path:"/reports",component:m(n,null)},a(),i(),s()})}}}),System.register("reports/components/ReportList",["flarum/Component","flarum/components/LoadingIndicator","flarum/helpers/avatar","flarum/helpers/username","flarum/helpers/icon","flarum/helpers/humanTime"],function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var r,n,a,i,s,u,c,p=function(){function t(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,o,r){return o&&t(e.prototype,o),r&&t(e,r),e}}(),l=function(t,e,o){for(var r=!0;r;){var n=t,a=e,i=o;s=c=u=void 0,r=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(i)}var c=Object.getPrototypeOf(n);if(null===c)return void 0;t=c,e=a,o=i,r=!0}};return{setters:[function(t){r=t["default"]},function(t){n=t["default"]},function(t){a=t["default"]},function(t){i=t["default"]},function(t){s=t["default"]},function(t){u=t["default"]}],execute:function(){c=function(t){function r(){e(this,r);for(var t=arguments.length,o=Array(t),n=0;t>n;n++)o[n]=arguments[n];l(Object.getPrototypeOf(r.prototype),"constructor",this).apply(this,o),this.loading=!1}return o(r,t),p(r,[{key:"view",value:function(){var t=app.cache.reports||[];return m("div",{className:"NotificationList ReportList"},m("div",{className:"NotificationList-header"},m("h4",{className:"App-titleControl App-titleControl--text"},"Reported Posts")),m("div",{className:"NotificationList-content"},m("ul",{className:"NotificationGroup-content"},t.length?t.map(function(t){var e=t.post();return m("li",null,m("a",{href:app.route.post(e),className:"Notification Report",config:function(t,o){m.route.apply(this,arguments),o||$(t).on("click",function(){return app.cache.reportIndex=e})}},a(e.user()),s("flag",{className:"Notification-icon"}),m("span",{className:"Notification-content"},i(e.user())," in ",m("em",null,e.discussion().title())),u(t.time()),m("div",{className:"Notification-excerpt"},e.contentPlain())))}):this.loading?n.component({className:"LoadingIndicator--block"}):m("div",{className:"NotificationList-empty"},app.trans("reports.no_reports")))))}},{key:"load",value:function(){var t=this;(!app.cache.reports||app.forum.attribute("unreadReportsCount"))&&(this.loading=!0,m.redraw(),app.store.find("reports").then(function(e){app.forum.pushAttributes({unreadReportsCount:0}),app.cache.reports=e.sort(function(t,e){return e.time()-t.time()}),t.loading=!1,m.redraw()}))}}]),r}(r),t("default",c)}}}),System.register("reports/components/ReportPostModal",["flarum/components/Modal","flarum/components/Button"],function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var r,n,a,i=function(){function t(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,o,r){return o&&t(e.prototype,o),r&&t(e,r),e}}(),s=function(t,e,o){for(var r=!0;r;){var n=t,a=e,i=o;s=c=u=void 0,r=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(i)}var c=Object.getPrototypeOf(n);if(null===c)return void 0;t=c,e=a,o=i,r=!0}};return{setters:[function(t){r=t["default"]},function(t){n=t["default"]}],execute:function(){a=function(t){function r(){e(this,r);for(var t=arguments.length,o=Array(t),n=0;t>n;n++)o[n]=arguments[n];s(Object.getPrototypeOf(r.prototype),"constructor",this).apply(this,o),this.reason=m.prop(""),this.reasonDetail=m.prop("")}return o(r,t),i(r,[{key:"className",value:function(){return"ReportPostModal Modal--small"}},{key:"title",value:function(){return"Report Post"}},{key:"content",value:function(){return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"Choose a Reason"),m("div",null,m("label",{className:"checkbox"},m("input",{type:"radio",name:"reason",checked:"off_topic"===this.reason(),value:"off_topic",onclick:m.withAttr("value",this.reason)}),"Off-topic"),m("label",{className:"checkbox"},m("input",{type:"radio",name:"reason",checked:"inappropriate"===this.reason(),value:"inappropriate",onclick:m.withAttr("value",this.reason)}),"Inappropriate"),m("label",{className:"checkbox"},m("input",{type:"radio",name:"reason",checked:"spam"===this.reason(),value:"spam",onclick:m.withAttr("value",this.reason)}),"Spam"),m("label",{className:"checkbox"},m("input",{type:"radio",name:"reason",checked:"other"===this.reason(),value:"other",onclick:m.withAttr("value",this.reason)}),"Other","other"===this.reason()?m("textarea",{className:"FormControl",value:this.reasonDetail(),oninput:m.withAttr("value",this.reasonDetail)}):""))),m("div",{className:"Form-group"},m(n,{className:"Button Button--primary",type:"submit",loading:this.loading,disabled:!this.reason()},"Report Post"))))}},{key:"onsubmit",value:function(t){var e=this;t.preventDefault(),this.loading=!0,app.store.createRecord("reports").save({reason:"other"===this.reason()?null:this.reason(),reasonDetail:this.reasonDetail(),relationships:{user:app.session.user,post:this.props.post}}).then(function(){return e.hide()},function(){e.loading=!1,m.redraw()})}}]),r}(r),t("default",a)}}}),System.register("reports/components/ReportsDropdown",["flarum/components/NotificationsDropdown","reports/components/ReportList"],function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var r,n,a,i=function(){function t(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,o,r){return o&&t(e.prototype,o),r&&t(e,r),e}}(),s=function(t,e,o){for(var r=!0;r;){var n=t,a=e,i=o;s=c=u=void 0,r=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(i)}var c=Object.getPrototypeOf(n);if(null===c)return void 0;t=c,e=a,o=i,r=!0}};return{setters:[function(t){r=t["default"]},function(t){n=t["default"]}],execute:function(){a=function(t){function r(){e(this,r);for(var t=arguments.length,o=Array(t),a=0;t>a;a++)o[a]=arguments[a];s(Object.getPrototypeOf(r.prototype),"constructor",this).apply(this,o),this.list=new n}return o(r,t),i(r,null,[{key:"initProps",value:function(t){t.label=t.label||"Reports",t.icon=t.icon||"flag",s(Object.getPrototypeOf(r),"initProps",this).call(this,t)}}]),i(r,[{key:"goToRoute",value:function(){m.route(app.route("reports"))}},{key:"getUnreadCount",value:function(){return app.forum.attribute("unreadReportsCount")}}]),r}(r),t("default",a)}}}),System.register("reports/components/ReportsPage",["flarum/components/Page","reports/components/ReportList"],function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var r,n,a,i=function(){function t(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,o,r){return o&&t(e.prototype,o),r&&t(e,r),e}}(),s=function(t,e,o){for(var r=!0;r;){var n=t,a=e,i=o;s=c=u=void 0,r=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(i)}var c=Object.getPrototypeOf(n);if(null===c)return void 0;t=c,e=a,o=i,r=!0}};return{setters:[function(t){r=t["default"]},function(t){n=t["default"]}],execute:function(){a=function(t){function r(){e(this,r);for(var t=arguments.length,o=Array(t),a=0;t>a;a++)o[a]=arguments[a];s(Object.getPrototypeOf(r.prototype),"constructor",this).apply(this,o),app.history.push("reports"),this.list=new n,this.list.load(),this.bodyClass="App--reports"}return o(r,t),i(r,[{key:"view",value:function(){return m("div",{className:"ReportsPage"},this.list.render())}}]),r}(r),t("default",a)}}}),System.register("reports/models/Report",["flarum/Model","flarum/utils/mixin"],function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var r,n,a,i=function(t,e,o){for(var r=!0;r;){var n=t,a=e,i=o;s=c=u=void 0,r=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(i)}var c=Object.getPrototypeOf(n);if(null===c)return void 0;t=c,e=a,o=i,r=!0}};return{setters:[function(t){r=t["default"]},function(t){n=t["default"]}],execute:function(){a=function(t){function r(){e(this,r),i(Object.getPrototypeOf(r.prototype),"constructor",this).apply(this,arguments)}return o(r,t),r}(n(r,{reporter:r.attribute("reporter"),reason:r.attribute("reason"),reasonDetail:r.attribute("reasonDetail"),time:r.attribute("time",r.transformDate),post:r.hasOne("post"),user:r.hasOne("user")})),t("default",a)}}});